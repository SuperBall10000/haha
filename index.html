<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Bar Chart with Mapbox</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        #map {
            width: 100vw;
            height: 100vh;
        }
        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            z-index: 1000;
            max-width: 300px;
        }
        .zoom-display {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #333;
            z-index: 1000;
            font-size: 18px;
            font-weight: bold;
        }
        .token-warning {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 2000;
            max-width: 400px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div id="token-warning" class="token-warning">
        <h3>⚠️ Mapbox Token Required</h3>
        <p>Please add your Mapbox access token to line 84 of this file.</p>
        <p>Get your free token at <a href="https://www.mapbox.com/" target="_blank" style="color: #4ECDC4;">mapbox.com</a></p>
    </div>

    <div class="info-panel">
        <h3>Scroll-Animated Bar Chart</h3>
        <p>Scroll to zoom and watch the bars grow from 13 → 14!</p>
    </div>

    <div class="zoom-display">
        Zoom: <span id="zoom-level">1.0</span>
    </div>

    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1Ijoic3VwZXJqYWNrYmF1ZXIiLCJhIjoiY2twejZnNjlkMDYwazJ4cWI3dmxlc3ZieiJ9.1SCM6Yq0Gu4D3GFCA38F1g';

        if (mapboxgl.accessToken === 'YOUR_MAPBOX_ACCESS_TOKEN_HERE') {
            console.error('Please add your Mapbox access token!');
        } else {
            document.getElementById('token-warning').classList.add('hidden');
        }

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v10',
            center: [-73.99, 40.725],
            zoom: 13,
            minZoom: 13,
            maxZoom: 14
        });

        map.on('load', function() {
            fetch('./bar-chart-zoom-13-to-14.json')
                .then(response => response.json())
                .then(data => {
                    map.addSource('bar-chart', {
                        type: 'geojson',
                        data: data
                    });

                    map.addLayer({
                        id: 'bar-segments',
                        type: 'fill',
                        source: 'bar-chart',
                        paint: {
                            'fill-color': [
                                'case',
                                ['==', ['get', 'bar_id'], 1], '#FF6B6B',
                                ['==', ['get', 'bar_id'], 2], '#4ECDC4',
                                ['==', ['get', 'bar_id'], 3], '#45B7D1',
                                ['==', ['get', 'bar_id'], 4], '#96CEB4',
                                ['==', ['get', 'bar_id'], 5], '#FFEAA7',
                                '#FFFFFF'
                            ],
                            'fill-opacity': 0.8
                        },
                        filter: ['all',
                            ['>=', ['zoom'], ['get', 'min_zoom']],
                            ['<=', ['zoom'], ['get', 'max_zoom']]
                        ]
                    });

                    map.addLayer({
                        id: 'bar-outlines',
                        type: 'line',
                        source: 'bar-chart',
                        paint: {
                            'line-color': '#FFFFFF',
                            'line-width': 1,
                            'line-opacity': 0.6
                        },
                        filter: ['all',
                            ['>=', ['zoom'], ['get', 'min_zoom']],
                            ['<=', ['zoom'], ['get', 'max_zoom']]
                        ]
                    });

                    function updateDisplay() {
                        const zoom = map.getZoom();
                        document.getElementById('zoom-level').textContent = zoom.toFixed(2);
                    }

                    map.on('zoom', updateDisplay);
                    updateDisplay();
                });

            map.on('mouseenter', 'bar-segments', function(e) {
                map.getCanvas().style.cursor = 'pointer';
                const barId = e.features[0].properties.bar_id;
                const segmentLevel = e.features[0].properties.segment_level;
                const popup = new mapboxgl.Popup({ closeButton: false, closeOnClick: false })
                    .setLngLat(e.lngLat)
                    .setHTML(`<div style="background: #1a1a1a; color: white; padding: 10px; border-radius: 5px;">
                        <strong>Bar ${barId}</strong><br>Segment ${segmentLevel}</div>`)
                    .addTo(map);
                map._currentPopup = popup;
            });

            map.on('mouseleave', 'bar-segments', () => {
                map.getCanvas().style.cursor = '';
                if (map._currentPopup) {
                    map._currentPopup.remove();
                    map._currentPopup = null;
                }
            });
        });

        map.scrollZoom.setWheelZoomRate(1 / 200);
        map.dragRotate.disable();
        map.touchZoomRotate.disableRotation();
    </script>
</body>
</html>
